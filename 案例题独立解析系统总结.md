# 案例题独立解析系统总结

## 📋 项目概述

为了更好地管理和展示一建机电实务的案例题，我们创建了一个独立的案例题解析系统，将案例题从普通选择题中分离出来，使用更合理的数据结构进行存储和管理。

## 🎯 核心改进

### 1. 数据结构重新设计

#### 旧的数据结构（不合理）

```json
{
  "number": 31,
  "type": "案例题",
  "question": "【案例（一）】\n\n背景资料：\n...\n\n问题1：\n氨制冷站施工前应履行何种手续？",
  "options": {},
  "answer": null
}
```

**问题**:
- ❌ 每个小问题作为独立题目，背景资料重复存储
- ❌ 无法体现案例题的整体结构
- ❌ 无法单独管理案例的分值信息
- ❌ 数据冗余严重

#### 新的数据结构（合理）

```json
{
  "case_number": 1,
  "year": 2010,
  "subject": "机电实务",
  "title": "案例（一）",
  "background": "某机电安装公司具有压力容器、压力管道安装资格...",
  "score": 20,
  "sub_questions": [
    {
      "sub_number": 1,
      "question": "氨制冷站施工前应履行何种手续？",
      "answer": null,
      "analysis": null
    },
    {
      "sub_number": 2,
      "question": "安装公司对容器补焊处理是否合法，说明理由。",
      "answer": null,
      "analysis": null
    }
  ]
}
```

**优点**:
- ✅ 案例题作为一个整体，背景资料只存储一次
- ✅ 小问题作为子题目数组，结构清晰
- ✅ 可以单独管理案例的分值信息
- ✅ 数据结构符合实际考试场景
- ✅ 便于前端展示和答题

### 2. 独立的解析器

创建了专门的 `case_parser.py` 案例题解析器：

**核心类**:
- `SubQuestion`: 案例题的小问题数据类
- `CaseStudy`: 案例题数据类
- `CaseStudyParser`: 案例题解析器

**主要功能**:
- 从PDF中提取案例题部分
- 识别案例标记（支持两种格式）
- 提取背景资料和小问题
- 提取分值信息
- 保存到独立的JSON文件

### 3. 独立的JSON文件

案例题数据保存在独立的文件中：
- 文件路径: `机电历年真题/parsed_data/机电实务_案例题.json`
- 与选择题分离，便于管理
- 可以单独加载和使用

## 📊 解析结果统计

### 总体统计

```
总案例数: 26个
总小问题数: 118个
覆盖年份: 2007-2012年
```

### 按年份详细统计

| 年份 | 案例数 | 小问题数 | 平均每案例 |
|------|--------|----------|------------|
| 2007年 | 5 | 21 | 4.2 |
| 2008年 | 1 | 4 | 4.0 |
| 2009年 | 5 | 25 | 5.0 |
| 2010年 | 5 | 23 | 4.6 |
| 2011年 | 5 | 22 | 4.4 |
| 2012年 | 5 | 23 | 4.6 |

### 解析成功率

- ✅ 2007-2012年: 100% 成功
- ⚠️ 2013-2021年: 未成功（可能是PDF格式不同或内容缺失）

## 🔧 技术实现

### 1. 案例标记识别

支持两种案例标记格式：

**格式1**: `（一）`、`（二）`、`（三）`...
```python
case_pattern1 = r'\n[（(]([一二三四五六七八九十])[）)]\s*\n'
```

**格式2**: `【案例一】`、`【案例二】`...
```python
case_pattern2 = r'【案例([一二三四五六七八九十])】'
```

### 2. 背景资料提取

三种提取方法，按优先级尝试：

**方法1**: 查找"背景资料"标记
```python
background_match = re.search(
    r'背景资料[：:]\s*(.*?)(?=问\s*题|$)', 
    case_content, 
    re.DOTALL
)
```

**方法2**: 取"问题"之前的内容
```python
problem_match = re.search(r'问\s*题', case_content)
if problem_match:
    background = case_content[:problem_match.start()].strip()
```

**方法3**: 取小问题之前的内容
```python
lines = case_content.split('\n')
background_lines = []
for line in lines:
    if re.match(r'\d+[.、．]', line.strip()):
        break
    background_lines.append(line)
```

### 3. 小问题提取

支持多行问题的提取：

```python
sub_pattern = r'(\d+)[.、．]\s*([^\n]+(?:\n(?!\d+[.、．])[^\n]+)*)'
sub_matches = re.findall(sub_pattern, problem_section)
```

### 4. 分值信息提取

从案例题标题中提取分值：

```python
# 匹配：（一）、（二）、（三）题各 20 分，（四）、（五）题各 30 分
score_pattern = r'[（(]([一二三四五六七八九十、]+)[）)].*?各?\s*(\d+)\s*分'
matches = re.findall(score_pattern, case_section)
```

## 📁 文件结构

### 新增文件

```
Desktop/kaoLong/
├── case_parser.py                          # 案例题解析器
├── 机电历年真题/
│   └── parsed_data/
│       └── 机电实务_案例题.json            # 案例题数据（独立）
└── 案例题独立解析系统总结.md               # 本文档
```

### 数据文件对比

**选择题数据**: `机电实务_questions.json`
- 包含单选题和多选题
- 每个题目有题号、题型、题干、选项、答案

**案例题数据**: `机电实务_案例题.json`
- 包含案例题
- 每个案例有背景资料和多个小问题
- 结构更清晰，便于管理

## 💡 使用示例

### 1. 解析案例题

```python
from case_parser import CaseStudyParser

parser = CaseStudyParser()

# 解析单个PDF
case_studies = parser.parse_pdf(
    'path/to/pdf', 
    year=2010, 
    subject='机电实务'
)

# 保存到JSON
parser.save_to_json(case_studies, 'output.json')
```

### 2. 加载案例题

```python
from case_parser import CaseStudyParser

parser = CaseStudyParser()

# 从JSON加载
case_studies = parser.load_from_json('机电实务_案例题.json')

# 遍历案例题
for cs in case_studies:
    print(f'{cs.title} ({cs.year}年)')
    print(f'背景资料: {cs.background}')
    for sq in cs.sub_questions:
        print(f'  {sq.sub_number}. {sq.question}')
```

### 3. 数据结构访问

```python
import json

with open('机电实务_案例题.json', 'r', encoding='utf-8') as f:
    data = json.load(f)

# 总体统计
print(f'总案例数: {data["total_cases"]}')
print(f'总小问题数: {data["total_sub_questions"]}')

# 访问具体案例
for cs in data['case_studies']:
    if cs['year'] == 2010:
        print(f'{cs["title"]}: {len(cs["sub_questions"])}个小问题')
```

## 🎯 优势总结

### 1. 数据结构优势

| 方面 | 旧结构 | 新结构 |
|------|--------|--------|
| 背景资料 | 每个小问题重复存储 | 只存储一次 |
| 案例整体性 | 无法体现 | 清晰体现 |
| 分值管理 | 无法管理 | 可以管理 |
| 数据冗余 | 严重 | 最小化 |
| 前端展示 | 复杂 | 简单 |

### 2. 管理优势

- ✅ 独立的JSON文件，便于单独管理
- ✅ 独立的解析器，便于维护和扩展
- ✅ 清晰的数据结构，便于理解和使用
- ✅ 支持多种案例标记格式，兼容性好

### 3. 使用优势

- ✅ 符合实际考试场景
- ✅ 便于前端展示（可以展示完整的案例背景）
- ✅ 便于答题（可以一次性展示所有小问题）
- ✅ 便于统计（可以按案例统计，也可以按小问题统计）

## 📈 后续工作

### 1. 答案提取

目前案例题的答案字段为空，需要：
- 从PDF的答案部分提取案例题答案
- 匹配答案到对应的小问题
- 更新JSON文件

### 2. 解析更多年份

2013-2021年的案例题未成功解析，需要：
- 分析这些年份PDF的格式差异
- 调整解析逻辑以支持不同格式
- 或手动补充这些年份的案例题

### 3. 前端展示

需要在前端实现案例题的展示：
- 展示完整的背景资料
- 展示所有小问题
- 支持逐个小问题答题
- 显示答案和解析

### 4. 数据库集成

将案例题数据集成到SQLite数据库：
- 创建案例题表和小问题表
- 建立关联关系
- 支持查询和筛选

## 🎓 总结

通过创建独立的案例题解析系统，我们实现了：

1. **更合理的数据结构**: 案例题作为整体，小问题作为子题目
2. **独立的数据管理**: 案例题数据独立存储，便于管理
3. **专门的解析器**: 针对案例题的特点设计，解析更准确
4. **更好的可扩展性**: 便于后续添加答案、解析等功能

**关键成果**:
- ✅ 成功解析 26个案例题，118个小问题
- ✅ 覆盖 2007-2012年，6个年份
- ✅ 数据结构清晰，符合实际场景
- ✅ 独立管理，便于维护和扩展

现在案例题的数据结构和管理方式已经完全优化，可以为一建机电备考提供更好的支持！

