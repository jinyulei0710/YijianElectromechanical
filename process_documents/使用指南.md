# 一建机电备考 AI Agent 使用指南

## 📋 目录
1. [系统简介](#系统简介)
2. [快速开始](#快速开始)
3. [详细使用说明](#详细使用说明)
4. [常见问题](#常见问题)
5. [技术架构](#技术架构)

---

## 系统简介

这是一个基于AI的一级建造师机电工程备考助手，主要功能包括：

- ✅ **自动解析PDF教材**：支持解析四个科目的PDF教材
- ✅ **智能知识检索**：使用向量数据库实现语义搜索
- ✅ **AI问答辅助**：基于教材内容提供专业解答
- ✅ **多科目支持**：工程经济、机电实务、法律法规、项目管理

---

## 快速开始

### 第一步：安装依赖

```bash
cd Desktop/kaoLong
pip install -r requirements.txt
```

### 第二步：配置API密钥

1. 复制配置文件模板：
```bash
cp .env .env
```

2. 编辑 `.env` 文件，填入你的OpenAI API密钥：
```
OPENAI_API_KEY=sk-your-api-key-here
OPENAI_BASE_URL=https://api.openai.com/v1
```

> 💡 提示：如果使用国内API服务（如智谱AI、通义千问等），需要修改 `OPENAI_BASE_URL`

### 第三步：初始化知识库

```bash
python init_knowledge_base.py
```

这个过程会：
- 解析所有PDF教材（约需3-5分钟）
- 提取文本内容并分块
- 构建向量数据库用于语义检索

### 第四步：启动AI助手

```bash
python main.py
```

或者直接运行：
```bash
python ai_agent.py
```

---

## 详细使用说明

### 1. 提问技巧

**好的提问示例：**
- "什么是工程造价？"
- "机电工程施工的主要流程是什么？"
- "建设工程招投标的法律规定有哪些？"
- "项目进度管理的方法有哪些？"
- "解释一下网络计划技术"

**不太好的提问：**
- "考试重点是什么？"（太宽泛）
- "这道题怎么做？"（需要提供具体题目）

### 2. 交互命令

在对话界面中，你可以使用以下命令：

- **直接提问**：输入你的问题，AI会基于教材回答
- `stats`：查看知识库统计信息
- `help`：显示帮助信息
- `exit` 或 `quit`：退出程序

### 3. 重新初始化知识库

如果需要重新解析PDF或清空知识库：

```bash
python init_knowledge_base.py --reset
```

系统会提示确认，输入 `yes` 继续。

---

## 常见问题

### Q1: 提示"知识库未初始化"怎么办？

**A:** 运行初始化脚本：
```bash
python init_knowledge_base.py
```

### Q2: 提示"OPENAI_API_KEY未设置"怎么办？

**A:** 
1. 确保已创建 `.env` 文件
2. 在文件中正确设置了 `OPENAI_API_KEY=你的密钥`
3. 密钥格式正确（通常以 `sk-` 开头）

### Q3: PDF解析失败怎么办？

**A:** 检查以下几点：
1. PDF文件是否存在于正确的目录
2. PDF文件是否损坏
3. 是否有足够的磁盘空间
4. Python是否有读取文件的权限

### Q4: AI回答不准确怎么办？

**A:** 
1. 尝试换个方式提问，更具体一些
2. 检查知识库是否正确初始化
3. 查看AI回答中的"参考来源"，确认是否检索到相关内容

### Q5: 如何使用国内API服务？

**A:** 修改 `.env` 文件中的 `OPENAI_BASE_URL`，例如：
```
# 智谱AI
OPENAI_BASE_URL=https://open.bigmodel.cn/api/paas/v4/

# 通义千问（需要使用兼容的SDK）
OPENAI_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
```

同时需要修改 `ai_agent.py` 中的模型名称。

### Q6: 知识库占用空间太大怎么办？

**A:** 
- 向量数据库会占用一定空间（通常几百MB）
- 可以删除 `Desktop/kaoLong/data/chroma_db` 目录来清理
- 如需重新使用，运行 `python init_knowledge_base.py`

---

## 技术架构

### 核心模块

1. **pdf_parser.py** - PDF解析模块
   - 使用 `pdfplumber` 提取文本
   - 智能分块（按句子分割，每块约500字符）
   - 保留元数据（页码、科目、来源）

2. **knowledge_base.py** - 知识库管理
   - 使用 `ChromaDB` 向量数据库
   - 支持语义检索
   - 持久化存储

3. **ai_agent.py** - AI问答核心
   - 集成 OpenAI API
   - RAG（检索增强生成）架构
   - 上下文管理和提示词工程

4. **init_knowledge_base.py** - 初始化脚本
   - 批量解析PDF
   - 构建向量索引
   - 进度显示

5. **main.py** - 主程序入口
   - 环境检查
   - 启动交互界面

### 数据流程

```
PDF教材 
  ↓ (pdf_parser.py)
文本块 + 元数据
  ↓ (knowledge_base.py)
向量数据库
  ↓ (检索)
相关上下文
  ↓ (ai_agent.py)
AI生成回答
```

### 依赖库

- `pdfplumber`: PDF文本提取
- `chromadb`: 向量数据库
- `openai`: OpenAI API客户端
- `langchain`: LLM应用框架（可选）
- `python-dotenv`: 环境变量管理

---

## 进阶使用

### 自定义模型

编辑 `ai_agent.py`，修改模型参数：

```python
response = self.client.chat.completions.create(
    model="gpt-4",  # 改为其他模型
    temperature=0.7,  # 调整创造性（0-1）
    max_tokens=2000  # 调整回答长度
)
```

### 调整检索数量

在提问时，系统默认检索5个相关文本块。可以修改：

```python
# 在 ai_agent.py 的 answer 方法中
contexts = self.kb.search(question, n_results=10)  # 增加到10个
```

### 添加新的PDF教材

1. 将PDF放入对应科目目录
2. 修改 `pdf_parser.py` 中的 `parse_all_pdfs` 函数，添加新文件路径
3. 重新运行 `python init_knowledge_base.py --reset`

---

## 许可证

本项目仅供学习和个人使用。

## 支持

如有问题，请检查：
1. 本使用指南的"常见问题"部分
2. README.md 文件
3. 代码中的注释说明

祝你备考顺利！🎓

